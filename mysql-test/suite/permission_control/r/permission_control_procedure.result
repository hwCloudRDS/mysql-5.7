USE mysql;
DROP TABLE IF EXISTS user_backup,proc_backup;
set sql_mode='';
CREATE TABLE user_backup LIKE user;
INSERT INTO user_backup SELECT * FROM user;
CREATE TABLE proc_backup LIKE proc;
INSERT INTO proc_backup SELECT * FROM proc;
CREATE USER 'root1'@'%' IDENTIFIED BY '123456';
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER ON *.* TO 'root1'@'%' WITH GRANT OPTION;
CREATE USER 'reserved_user1'@'%' IDENTIFIED BY '123456';
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER ON *.* TO 'reserved_user1'@'%' WITH GRANT OPTION;
CREATE USER 'reserved_user2'@'%' IDENTIFIED BY '123456';
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER ON *.* TO 'reserved_user2'@'%' WITH GRANT OPTION;
CREATE USER 'reserved_user3'@'%' IDENTIFIED BY '123456';
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, PROCESS, REFERENCES, INDEX, ALTER, SHOW DATABASES, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT, CREATE VIEW, SHOW VIEW, CREATE ROUTINE, ALTER ROUTINE, CREATE USER, EVENT, TRIGGER ON *.* TO 'reserved_user3'@'%' WITH GRANT OPTION;
CREATE USER 'super'@'%' IDENTIFIED BY '123456';
GRANT ALL PRIVILEGES ON *.* TO 'super'@'%' WITH GRANT OPTION;
show variables like 'rds%';
Variable_name	Value
rds_permission_control	ON
rds_reserved_users	reserved_user1,reserved_user2,reserved_user3
CREATE PROCEDURE pro1()
BEGIN
DROP USER reserved_user1;
END |
CALL pro1();
ERROR HY000: Operation DROP USER failed for 'reserved_user1'@'%'
CREATE PROCEDURE pro2()
BEGIN
DROP USER reserved_user2;
END |
CALL pro2();
CREATE PROCEDURE pro3()
BEGIN
DROP USER reserved_user3;
END |
CALL pro3();
DROP USER reserved_user1,root1,super;
DELETE FROM user;
INSERT INTO user SELECT * FROM user_backup;
DROP TABLE user_backup;
DROP TABLE proc;
RENAME TABLE proc_backup TO proc;
SET @@global.sql_mode = 'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION';
